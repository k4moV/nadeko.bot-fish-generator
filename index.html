<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generator pozycji z ryb do bota</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #6c8daf 0%, #4a6fa5 100%);
      color: #333;
      min-height: 100vh;
      padding-top: 20px;
    }

    .app-container {
      max-width: 900px;
      margin: 0 auto;
    }

    header h1 {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 15px;
      color: white;
    }

    .controls {
      background: rgba(255, 255, 255, 0.92);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
    }

    .control-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #4a6fa5;
    }

    input,
    select {
      width: calc(100% + 20px);
      padding: 12px;
      border: 2px solid #c0d2ff;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: #4a6fa5;
    }

    .checkbox-group {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .checkbox-item input[type="checkbox"] {
      width: auto;
      margin-right: 8px;
      color: #4a6fa5;
    }

    button {
      background: linear-gradient(135deg, #4a6fa5 0%, #6c8daf 100%);
      color: white;
      border: none;
      padding: 14px 28px;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.9px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
    }

    .output-section {
      background: rgba(255, 255, 255, 0.92);
      border-radius: 12px;
      padding: 20px;
      margin-top: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
    }

    #fishData {
      width: calc(100% + 20px);
      min-height: 400px;
      padding: 16px;
      border: 2px solid #c0d2ff;
      border-radius: 8px;
      font-family: monospace, sans-serif;
      resize: vertical;
      overflow-y: auto;
    }

    .copy-btn {
      position: absolute;
      right: 15px;
      top: 10px;
      background: #4a6fa5;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }

    .stats {
      display: flex;
      gap: 16px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .stat {
      background: #e8f0fe;
      padding: 10px 14px;
      border-radius: 6px;
      min-width: 150px;
    }
    .label { font-size: 0.95rem; color: #4a6fa5; }
    .value { font-size: 1.2rem; font-weight: bold; color: #2c3e50; }
  </style>
</head>
<body>
  <div class="app-container">
    <header>
      <h1>Generator pozycji z ryb do bota</h1>
      <p style="color:#7f9fc7;">Ustaw parametry i wygeneruj listę pozycji w formacie YML</p>
    </header>

    <div class="controls">
      <div class="control-group">
        <label for="fishCount">Ilość pozycji do wygenerowania</label>
        <input type="number" id="fishCount" min="1" max="100" value="25" />
      </div>

      <div class="control-group">
        <label>Zmień nazwy ryb (lista dostępnych):</label><br />
        <textarea
          id="fishNames"
          rows="4"
          style="width: calc(100% + 20px); padding: 12px; border: 2px solid #c0d2ff; border-radius: 8px; font-size: 0.95rem;"
        >
Odwołania do nazw i opisów po myślniku, jedna linia na jedną rybu:
Glowfin – Fish with glowing, neon-colored fins.
Shellcrag – Giant crab with a stone shell.
Abysswalker – Many-legged beast from the deepest ocean.
... (i tak dalej dla wszystkich z listy)
        </textarea>
      </div>

      <div class="control-group">
        <label>Warunki specjalne (kombinacje weather + spot + time):</label><br />
        <div style="margin-bottom: 8px;">
          <input type="checkbox" id="specialCondition1" /> <span style="margin-left: 6px;">Rain, Ocean, Dawn</span>
        </div>
        <div>
          <input type="checkbox" id="specialCondition2" /> <span style="margin-left: 6px;">Clear, River, Dusk</span>
        </div>
      </div>

      <button onclick="generatePositions()">Generuj pozycje</button>
    </div>

    <div class="output-section">
      <h2>Wygenerowane pozycje (YML)</h2>
      <p style="color:#7f9fc7; margin-bottom: 8px;">Kliknij przycisk "Kopiuj", aby pobrać dane do katalogu.</p>
      <div style="position:relative;">
        <textarea
          id="fishData"
          readonly
          placeholder="Twoje pozycje z ryb pojawią się tutaj..."
          style="
            width: calc(100% + 20px);
            padding: 16px;
            border: 2px solid #c0d2ff;
            border-radius: 8px;
            font-family: monospace, sans-serif;
            resize: vertical;
          "
        ></textarea>
        <button class="copy-btn" onclick="copyToClipboard()">Kopiuj</button>
      </div>

      <div class="stats">
        <div class="stat">
          <div class="label">Ryby wygenerowane</div>
          <div class="value" id="totalValue">0</div>
        </div>
        <div class="stat">
          <div class="label">Średnia szansa</div>
          <div class="value" id="avgChanceValue">0%</div>
        </div>
        <div class="stat">
          <div class="label">Rozkład gwiazdek (1–4)</div>
          <div class="value" id="starsDistributionValue">-</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Lista domyślnych ryb z opisami
    const defaultFishList = [
      "Glowfin – Fish with glowing, neon-colored fins.",
      "Shellcrag – Giant crab with a stone shell.",
      "Abysswalker – Many-legged beast from the deepest ocean.",
      "Hydraserpent – Multi-headed snake living in coral.",
      "Waveglider – Creature that flies above the surface.",
      "Pearlscale – Elegant mermaid-like fish with shiny scales.",
      "Stormray – Ray that shoots electric blue lightning.",
      "Bubblemouth – Round fish that traps prey in bubbles.",
      "Frosttentacle – Jellyfish that freezes water around it.",
      "Voidshark – Shadowy predator made of dark mist.",
      "Anchovy – Small, salty fish used in cooking.",
      "Angelfish – Popular, elegant, disk-shaped aquarium fish.",
      "Barracuda – Predatory fish with sharp, needle-like teeth.",
      "Bass – Popular freshwater game fish for anglers.",
      "Betta – Colorful fish known for aggressive behavior.",
      "Bluegill – Common North American freshwater sunfish species.",
      "Bonefish – Fast, silver fish found on flats.",
      "Burbot – Only freshwater member of cod family.",
      "Carp – Large, hardy freshwater bottom-feeding fish.",
      "Catfish – Fish recognized by whisker-like barbels.",
      "Cisco – Cold-water fish related to whitefish.",
      "Cod – Important commercial fish with white meat.",
      "Discus – Colorful, circular South American cichlid.",
      "Eel – Long, snake-like fish living in water.",
      "Flounder – Flatfish with both eyes on top.",
      "Goldfish – Common orange pet kept in bowls.",
      "Grouper – Large-mouthed predatory saltwater reef fish.",
      "Guppy – Small, vibrant, easy-to-breed aquarium fish.",
      "Haddock – Saltwater fish similar to Atlantic cod.",
      "Hake – Lean, white-fleshed marine food fish.",
      "Halibut – Largest type of flatfish in oceans.",
      "Herring – Forage fish often served pickled or smoked.",
      "Hoki – Deep-sea fish caught near New Zealand.",
      "Ide – Silvery freshwater fish of northern Europe.",
      "Inconnu – Large, predatory northern whitefish species.",
      "Kaluga – Giant predatory sturgeon from Amur River.",
      "Kanyu – Predatory cyprinid found in East Asia.",
      "Killifish – Small, hardy, and very colorful fish.",
      "Koi – Decorative, brightly colored Japanese carp.",
      "Kokanee – Non-anadromous form of sockeye salmon.",
      "Mackerel – Oily fish with stripes on back.",
      "Marlin – Large game fish with long bill.",
      "Molly – Popular live-bearing fish for home aquariums.",
      "Mullet – Coastal fish often seen jumping frequently.",
      "Muskellunge – Large, aggressive North American freshwater predator.",
      "Perch – Common freshwater fish with spiny fins.",
      "Pickerel – Smaller relative of the northern pike.",
      "Pike – Ambush predator with long, pointed snout.",
      "Plaice – Flatfish known for orange spots.",
      "Pollock – Marine fish used for frozen products."
    ];

    // Inicjalizacja textarea z nazwami ryb
    document.getElementById("fishNames").value = defaultFishList.join("\n");

    /**
     * Wybiera jedną linie z listy (odpowiednio odseparowaną nazwę i opis).
     * Przykład: "Glowfin – Fish with glowing, neon-colored fins."
     */
    function getRandomFishLine() {
      const randIndex = Math.floor(Math.random() * defaultFishList.length);
      return defaultFishList[randIndex];
    }

    /**
     * Parsuje listę wybranych nazw. Wiersze muszą być w formacie:
     * "Nazwa – Opis"
     */
    function parseUserFishNames() {
      const raw = document.getElementById("fishNames").value.trim();
      if (!raw) return [];
      // Rozdziłać na linie
      const lines = raw.split("\n");
      const parsed = [];
      for (const line of lines) {
        const trimmed = line.trim();
        if (trimmed && trimmed.includes("–")) {
          // Domyślny separator – możesz zmienić na inny
          const [namePart] = trimmed.split("–");
          // Upewnienie się, że nazwa nie jest pusta
          const name = namePart.trim();
          if (name) {
            parsed.push(name);
          }
        }
      }
      return parsed;
    }

    /**
     * Generuje listę obiektów z danymi dla każdej ryby.
     */
    function generateFishPositions(count, fishNames, specialConditions) {
      const positions = [];
      const allWeather = ["Rain", "Clear", "Snow", "Storm"];
      const allSpots = ["Ocean", "River", "Reef", "Swamp", "Lake"];
      const allTimes = ["Dawn", "Dusk", "Day", "Night"];

      // Zbiór wszystkich możliwych kombinacji
      const allCombinations = [];
      for (const w of allWeather) {
        for (const s of allSpots) {
          for (const t of allTimes) {
            allCombinations.push([w, s, t].join(","));
          }
        }
      }

      // Ustawienie standardowych prawdopodobieństw dla każdej kombinacji
      const comboChances = {};
      // Domyślnie każde podejście ma 100% szansy (rozwiązanie domyślne)
      for (const comb of allCombinations) {
        comboChances[comb] = 100;
      }

      // Jeśli zaznaczono specjalne kombinacje, przypisz im większe wartości
      if (specialConditions && specialConditions.length > 0) {
        const selectedCombs = [];
        for (const sc of specialConditions) {
          // Format: "Rain,Ocean,Dawn"
          selectedCombs.push(sc);
        }
        for (const comb of selectedCombs) {
          // Upewnienie się, że kombinacja jest dostępna
          if (!comboChances[comb]) {
            comboChances[comb] = 100; // domyślna wartość
          } else {
            // Jeśli już była ustawiona, zwiększ ją np o 30%
            comboChances[comb] += 25;
          }
        }
      }

      // Funkcja do wyboru kombinacji
      function pickRandomCombination() {
        // Prawdopodobieństwo dla każdej kombinacji jest proporcjonalne do jej wartości
        const total = sumValues(Object.values(comboChances));
        const randScore = Math.random() * total;
        let accumulated = 0;
        for (const comb of allCombinations) {
          accumulated += comboChances[comb];
          if (accumulated >= randScore) {
            return comb;
          }
        }
        // W razie błędu zwracamy ostatnią
        return allCombinations[allCombinations.length - 1];
      }

      function sumValues(arr) {
        let sum = 0;
        for (const val of arr) {
          sum += val;
        }
        return sum;
      }

      // Generuj pozycje
      for (let i = 0; i < count; i++) {
        const fishName =
          fishNames.length > 0
            ? parseUserFishNames()[Math.floor(Math.random() * fishNames.length)]
            : getRandomFishLine();

        // Wybierz kombinację
        const combo = pickRandomCombination();
        const weather = combo.split(",")[0] || "";
        const spot = combo.split(",")[1] || "";
        const time = combo.split(",")[2] || "";

        // Losowe prawdopodobieństwo między 1–100
        const chance = Math.max(1, Math.min(100, Math.random() * 99 + 1));

        // Losowa ilość gwiazdek od 1 do 4
        const stars = Math.floor(Math.random() * 4) + 1;

        // Tworzenie krótkiego opisu jednozdaniowego
        const fluff =
          fishName +
          (fishName.includes("–") ? "" : " " ) +
          " " +
          ("Common".includes(fishName.split(" ")[1] || "") ? "Very common." : "Typical.");

        positions.push({
          id: i + 1,
          name: fishName.trim(),
          weather: weather.trim() || "",
          spot: spot.trim() || "",
          time: time.trim() || "",
          chance,
          stars,
          fluff: fluff.trim(),
          condition: "",
          image: "https://",
          emoji: "<>"
        });
      }
      return positions;
    }

    // Funkcja do formatowania listy w YML
    function formatYml(positions) {
      let yml = "";
      yml += "# Pozycje z ryb dla bota\n";
      yml += "positions:\n";
      for (const pos of positions) {
        yml += `  - id: ${pos.id}\n`;
        yml += `    name: "${pos.name}"\n`;
        yml += `    weather: "${pos.weather}"\n`;
        yml += `    spot: "${pos.spot}"\n`;
        yml += `    time: "${pos.time}"\n`;
        yml += `    chance: ${pos.chance}\n`;
        yml += `    stars: ${pos.stars}\n`;
        yml += `    fluff: "${pos.fluff}"\n`;
        yml += `    condition: ""\n`;
        yml += `    image: "https://"\n`;
        yml += `    emoji: "<>"\n\n`;
      }
      return yml;
    }

    // Inicjalne dane dla statystyk
    let totalFish = 0;
    let allChances = [];
    let starsCount = { "1": 0, "2": 0, "3": 0, "4": 0 };

    function updateStats(positions) {
      totalFish = positions.length;
      // Aktualizacja średniej szansy
      const totalChance = positions.reduce((sum, p) => sum + p.chance, 0);
      const avgChance = totalChance / totalFish || 1;
      document.getElementById("totalValue").textContent = totalFish;
      document.getElementById("avgChanceValue").textContent =
        (avgChance * 100).toFixed(2) + "%";
      // Obliczanie rozkładu gwiazdek
      for (const p of positions) {
        starsCount[p.stars] += 1;
      }
      const starsValues = Object.values(starsCount);
      document.getElementById("starsDistributionValue").textContent =
        "1:" + starsValues[0] + ", 2:" + starsValues[1] + ", 3:" + starsValues[2] + ", 4:" + starsValues[3];
    }

    function copyToClipboard() {
      const ymlText = document.getElementById("fishData").value;
      navigator.clipboard
        .writeText(ymlText)
        .then(() => alert("Dane zostały skopiowane do schowaka!"))
        .catch((err) => alert("Wystąpił błąd podczas kopiowania: " + err);
    }

    function generatePositions() {
      // Ustawienie zaznaczonych warunków
      const specialConditions = [];
      if (document.getElementById("specialCondition1").checked) {
        specialConditions.push("Rain,Ocean,Dawn");
      }
      if (document.getElementById("specialCondition2").checked) {
        specialConditions.push("Clear,River,Dusk");
      }

      // Pobierz ilość
      const fishCount = parseInt(document.getElementById("fishCount").value, 10);
      if (isNaN(fishCount) || fishCount < 1 || fishCount > 100) {
        alert("Proszę wybrać liczbę ryb od 1 do 100.");
        return;
      }

      // Pobierz nazwy
      const userFishNames = parseUserFishNames();

      // Generuj pozycje
      const positions = generateFishPositions(fishCount, userFishNames, specialConditions);

      // Aktualizuj YML
      document.getElementById("fishData").value = formatYml(positions);

      // Statystyki
      updateStats(positions);
    }

    // Inicjalny wywołanie dla środowiska w konsoli (opcjonalne)
    generatePositions();
  </script>
</body>
</html>
